{% extends 'core/base.html' %}
{% load crispy_forms_tags %}

{% block content %}

<div class="row">
    <div class="col-12 col-md-6 offset-md-3">

        {% if 'ok' in request.GET %}
            <h3 class="p-3 mb-4 bg-success rounded-3 shadow-sm text-light">
                Cita registrada exitosamente
            </h3>
        {% endif %}

        <form action="" method="post" hx-boost="true">
            {% csrf_token %}
            {{ form|crispy }}

            <button class="btn btn-primary" type="submit">Enviar</button>
        </form>

        <a href="/horarios">
            <button class="btn btn-secondary mt-2">Volver Atr치s</button>
        </a>
    </div>
    
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

</div>  

<!-- jQuery + Bootstrap Datepicker -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.es.min.js"></script>

<script>
$(function() {
    // Referencia jQuery al input con name='fecha' (funciona aunque crispy cambie el id)
    const $fecha = $("input[name='fecha']");
    const $vet = $("#id_veterinario");
    const $selectHora = $("#id_hora_inicial");

    // Si no existen los elementos, abortar y loggear para depurar
    if ($fecha.length === 0) {
        console.warn("No se encontr칩 input[name='fecha'] en el formulario.");
        return;
    }
    if ($vet.length === 0) {
        console.warn("No se encontr칩 #id_veterinario en el formulario.");
        return;
    }
    if ($selectHora.length === 0) {
        console.warn("No se encontr칩 #id_hora_inicial en el formulario.");
        return;
    }

    // Hacer readonly para evitar tipeo manual
    $fecha.prop('readonly', true);

    // Inicializar datepicker sobre el input encontrado
    $fecha.datepicker({
        format: 'dd/mm/yyyy',
        language: 'es',
        autoclose: true,
        todayHighlight: true,
        startDate: new Date()
    });

    $fecha.on('changeDate', function() {
        const event = new Event('change', { bubbles: true });
        this.dispatchEvent(event);
    });
});
</script>



{% endblock %}
